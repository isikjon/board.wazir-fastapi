{% extends "layout/base.html" %}

{% block title %}Wazir –ù–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç—å - –ü–æ–∏—Å–∫{% endblock %}

{% block extra_css %}
        <link rel="stylesheet"
            href="https://cdn.jsdelivr.net/npm/swiper@8/swiper-bundle.min.css" />
        <style>
            .bottom-nav {
                box-shadow: 0 -2px 10px rgba(0,0,0,0.05);
            } 
            .nav-item {
                transition: all 0.2s ease;
            }
            .nav-item.active {
                color: var(--color-primary); 
            }
            .nav-item:hover {
                color: var(--color-primary-hover);
            }
            .nav-icons {
                font-size: 1.6rem;
                font-weight: 300;
            }
            .weather-currency {
                font-size: 1.1rem;
                font-weight: 500;
            }
            .weather-icon {
                font-size: 1.4rem;
            }
            
            /* –°—Ç–∏–ª–∏ –¥–ª—è –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–æ–π –ø—Ä–æ–∫—Ä—É—Ç–∫–∏ –∫–∞—Ç–µ–≥–æ—Ä–∏–π */
            .categories-scroll {
                display: block; /* –ò–∑–º–µ–Ω—è–µ–º —Å flex –Ω–∞ block */
                overflow-x: auto;
                overflow-y: hidden;
                scrollbar-width: none;
                -ms-overflow-style: none;
                padding: 12px 8px;
                white-space: nowrap; /* –ó–∞–ø—Ä–µ—â–∞–µ–º –ø–µ—Ä–µ–Ω–æ—Å —Å—Ç—Ä–æ–∫ */
               
                -webkit-overflow-scrolling: touch; /* –î–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤ */
                width: 100%; /* –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–∞—è —à–∏—Ä–∏–Ω–∞ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ */
                max-width: 100vw; /* –ù–µ –±–æ–ª—å—à–µ —à–∏—Ä–∏–Ω—ã —ç–∫—Ä–∞–Ω–∞ */
            }
            .categories-scroll::-webkit-scrollbar {
                display: none;
            }
            
            .category-item {
                display: inline-block; /* –ò—Å–ø–æ–ª—å–∑—É–µ–º inline-block –≤–º–µ—Å—Ç–æ flex */
                vertical-align: top;
                width: 80px; /* –§–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —à–∏—Ä–∏–Ω–∞ */
                height: 80px;
                border-radius: 16px;
                transition: all 0.3s ease;
                position: relative;
                overflow: hidden;
                cursor: pointer;
                border: none;
                background: transparent;
            }
            
            .category-item:hover {
                transform: translateY(-2px);
            }
            
            .category-item.active {
                box-shadow: 7px 7px 7px -4px rgb(251 146 60);
            }
            
            .category-icon {
                width: 80px; /* –ö–∞—Ä—Ç–∏–Ω–∫–∞ –∑–∞–Ω–∏–º–∞–µ—Ç –≤—Å—é –∫–Ω–æ–ø–∫—É */
                height: 80px;
                transition: all 0.3s ease;
                border-radius: 16px;
                object-fit: cover;
            }
            
            .category-name {
                font-size: 10px;
                font-weight: 500;
                text-align: center;
                line-height: 1.2;
                white-space: normal;
                word-wrap: break-word;
                max-width: 70px;
            }
            
            .category-tabs {
                overflow-x: auto;
                -webkit-overflow-scrolling: touch;
                scrollbar-width: none;
                background-color: #f9fafb;
                border-bottom: 1px solid #e5e7eb;
                padding: 10px 0;
            }
            .category-tabs::-webkit-scrollbar {
                display: none;
            }
            .category-select {
                width: 100%;
                padding: 10px;
                border: 1px solid #e5e7eb;
                border-radius: 8px;
                font-size: 14px;
                color: #4b5563;
                background-color: white;
                outline: none;
                border-bottom: 1px solid #e5e7eb;
            }
            
            /* –°—Ç–∏–ª–∏ –¥–ª—è —Ä–µ–∫–ª–∞–º–Ω–æ–≥–æ —Å–ª–∞–π–¥–µ—Ä–∞ */
            .ads-slider {
                width: 100%;
                height: 85px;
                position: relative;
                overflow: hidden;
                border-radius: 8px;
                padding: 0 7px;
            }
            
            .ads-slider-container {
                width: 100%;
                height: 100%;
                position: relative;
                overflow: hidden;
                border-radius: 8px;
            }
            
            .ads-slides-wrapper {
                display: flex;
                width: 200%; /* 2 —Å–ª–∞–π–¥–∞ = 200% */
                height: 100%;
                transition: transform 0.5s ease-in-out;
            }
            
            .ads-slide {
                width: 50%; /* –ö–∞–∂–¥—ã–π —Å–ª–∞–π–¥ –∑–∞–Ω–∏–º–∞–µ—Ç 50% –æ—Ç wrapper */
                height: 100%;
                display: flex;
                align-items: center;
                justify-content: center;
                flex-shrink: 0;
            }
            
            .ads-slide.placeholder {
                background-color: #9ca3af;
                color: white;
                font-size: 1.2rem;
                font-weight: 500;
                text-align: center;
                font-family: 'Montserrat', sans-serif;
            }
            
            .ads-slide img {
                width: 100%;
                height: 100%;
                object-fit: cover;
            }
            
            .swiper {
                width: 100%;
                height: 180px;
                border-radius: 8px;
                overflow: hidden;
                position: relative;
                margin-bottom: 0;
            }
            .swiper-slide img {
                width: 100%;
                height: 100%;
                object-fit: cover;
            }
            .property-card {
                border-radius: 12px;
                overflow: hidden;
                box-shadow: 0 2px 10px rgba(0,0,0,0.05);
                margin-bottom: 16px;
            }
            .property-info {
                font-size: 1.05rem;
                line-height: 1.5;
                color: #4b5563;
            }
            .property-address {
                font-size: 0.95rem;
                color: #6b7280;
            }
            .property-price {
                font-size: 1.3rem;
                font-weight: 700;
                color: #111827;
            }
            .action-btn {
                flex: 1;
                display: flex;
                align-items: center;
                justify-content: center;
                padding: 10px;
                font-size: 1rem;
                font-weight: 500;
                transition: all 0.2s ease;
                border-radius: 0;
            }
            .action-btn i {
                margin-right: 6px;
                font-size: 1.1rem;
            }
            .action-btn.call-btn {
                background-color: #f9fafb;
                color: #4b5563;
                border-right: 1px solid #e5e7eb;
            }
            .action-btn.details-btn {
                background-color: #f9fafb;
                color: #4b5563;
            }
            .action-btn.tour-btn {
                background-color: #f9fafb;
                color: #4b5563;
            }
            .pagination-dot {
                width: 6px;
                height: 6px;
                background-color: rgba(255,255,255,0.5);
                border-radius: 50%;
                margin: 0 2px;
            }
            .pagination-dot.active {
                background-color: white;
                width: 8px;
                height: 8px;
            }
            .filter-panel {
                max-height: 0;
                overflow: hidden;
                transition: max-height 0.5s cubic-bezier(0, 1, 0, 1);
                padding: 0 16px;
                border-radius: 8px;
                margin-bottom: 0;
            }
            .filter-panel.open {
                max-height: 2000px;
                transition: max-height 0.8s ease-in-out;
                padding: 16px;
                margin-bottom: 16px;
                background-color: #fff;
                box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            }
            .filter-panel.closed {
                display: none;
            }
            .filter-header {
                display: flex;
                justify-content: space-between;
                align-items: center;
                padding: 12px 16px;
                background-color: #fff;
                cursor: pointer;
                border-radius: 8px;
                margin-bottom: 8px;
                font-size: 1.05rem;
                font-weight: 400;
            }
            .applied-filters {
                background-color: #ffedd5;
                color: var(--color-primary);
                padding: 8px 16px;
                border-radius: 8px;
                display: flex;
                justify-content: space-between;
                align-items: center;
                margin-bottom: 16px;
                font-weight: 400;
                display: none;
            }
            .applied-filters.visible {
                display: flex;
            }
            .price-range {
                height: 6px;
                background: #e5e7eb;
                border-radius: 3px;
                position: relative;
            }
            .price-progress {
                height: 100%;
                background: var(--color-primary);
                position: absolute;
                border-radius: 3px;
            }
            .range-input {
                position: relative;
                margin-top: 24px;
                margin-bottom: 10px;
            }
            .range-input input {
                position: absolute;
                top: -30px;
                height: 6px;
                width: 100%;
                background: none;
                pointer-events: none;
                appearance: none;
            }
            .range-input input::-webkit-slider-thumb {
                height: 24px;
                width: 24px;
                border-radius: 50%;
                pointer-events: auto;
                appearance: none;
                background: white;
                border: 2px solid var(--color-primary);
                box-shadow: 0 1px 3px rgba(0,0,0,0.3);
                cursor: pointer;
            }
            .room-btn {
                padding: 8px 16px;
                border-radius: 4px;
                font-size: 1rem;
                transition: all 0.2s ease;
            }
            .room-btn.active {
                background-color: var(--color-primary);
                color: white;
                border-color: var(--color-primary);
            }
            .apartment-type-btn, .house-type-btn {
                padding: 8px 16px;
                border-radius: 4px;
                font-size: 1rem;
                transition: all 0.2s ease;
            }
            .apartment-type-btn.active, .house-type-btn.active {
                background-color: var(--color-primary);
                color: white;
                border-color: var(--color-primary);
            }
            .checkbox-label {
                font-size: 1rem;
            }
            .no-results {
                text-align: center;
                padding: 40px 20px;
                color: #6b7280;
            }
            .no-results i {
                font-size: 3rem;
                margin-bottom: 15px;
                color: #d1d5db;
            }

            .category-card {
                transition: all 0.3s ease;
                height: 75px; /* –£–º–µ–Ω—å—à–∞–µ–º –≤—ã—Å–æ—Ç—É */
                background-size: cover;
                background-position: center;
                position: relative;
                overflow: hidden;
                width: 100%; /* –î–µ–ª–∞–µ–º –∫–∞—Ä—Ç–æ—á–∫–∏ —à–∏—Ä–µ */
                border-radius: 12px; /* –°–∫—Ä—É–≥–ª–µ–Ω–∏–µ */
                display: flex;
                justify-content: flex-start; /* –í—ã—Ä–∞–≤–Ω–∏–≤–∞–µ–º —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ —Å–ª–µ–≤–∞ */
                align-items: flex-start; /* –í—ã—Ä–∞–≤–Ω–∏–≤–∞–µ–º —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ –≤–≤–µ—Ä—Ö—É */
            }
            .category-card:hover {
                transform: translateY(-2px);
                box-shadow: 0 6px 12px rgba(0,0,0,0.08);
            }
            .category-card.active {
                box-shadow: 7px 7px 7px -4px rgb(251 146 60);
            }
            .category-card::before {
                content: '';
                position: absolute;
                top: 0;
                left: 0;
                right: 0;
                bottom: 0;
                background: linear-gradient(90deg, rgba(0,0,0,0.5), rgba(0,0,0,0.3)); /* –£–≤–µ–ª–∏—á–∏–≤–∞–µ–º –∑–∞—Ç–µ–º–Ω–µ–Ω–∏–µ –¥–ª—è –ª—É—á—à–µ–π —á–∏—Ç–∞–µ–º–æ—Å—Ç–∏ */
            }
            .category-title {
                position: relative;
                z-index: 2;
                text-align: left; /* –¢–µ–∫—Å—Ç —Å–ª–µ–≤–∞ */
                padding-top: 9px;
                padding-left: 9px;
                font-size: 16px;
                text-shadow: 1px 1px 2px rgba(0,0,0,0.5); /* –¢–µ–Ω—å –¥–ª—è –ª—É—á—à–µ–π —á–∏—Ç–∞–µ–º–æ—Å—Ç–∏ */
                text-decoration: underline;
            }
            
            .room-btn.active,
            .apartment-type-btn.active,
            .house-type-btn.active {
                box-shadow: 5px 5px 5px -4px rgb(251 146 60 / 70%);
            }
            /* –°—Ç–∏–ª–∏ –¥–ª—è —Å–ª–∞–π–¥–µ—Ä–∞ –∫–∞—Ç–µ–≥–æ—Ä–∏–π */
            .categories-slider-container {
                margin: 0;
                width: 100%;
                background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);
                border-bottom: 1px solid #e2e8f0;
                padding-top: 5px;
            }
            
            .categories-swiper {
                width: 100%;
                height: 85px;
                padding: 0;
                margin: 0;
                overflow: hidden;
            }
            
            .categories-swiper .swiper-wrapper {
                padding: 0;
            }
            
            .categories-swiper .swiper-slide {
                width: 25% !important; /* –°—Ç—Ä–æ–≥–æ 4 —Å–ª–∞–π–¥–∞ = 25% –∫–∞–∂–¥—ã–π */
                height: 80px !important;
                display: flex !important;
                justify-content: center;
                align-items: center;
                margin: 0;
                padding: 0;
            }
            
            .categories-swiper .category-item {
                display: block;
                width: 90%; /* –ù–µ–º–Ω–æ–≥–æ –º–µ–Ω—å—à–µ —á–µ–º 100% –¥–ª—è –≤–∏–∑—É–∞–ª—å–Ω–æ–≥–æ –æ—Ç—Å—Ç—É–ø–∞ */
                height: 80px;
                border-radius: 10px;
                transition: all 0.3s ease;
                position: relative;
                overflow: hidden;
                cursor: pointer;
                border: none;
                background: transparent;
                padding: 0;
                margin: 0 auto;
            }
            
            .categories-swiper .category-item:hover {
                transform: translateY(-2px);
            }
            
            .categories-swiper .category-item.active {
                box-shadow: 5px 5px 5px -4px rgba(251, 146, 60, 0.65);
            }
            
            .categories-swiper .category-icon {
                width: 100%;
                height: 100%;
                transition: all 0.3s ease;
                object-fit: cover;
                display: block;
            }
            
            .categories-swiper .category-item.active .category-icon {
                box-shadow: 5px 5px 5px -4px rgba(251, 146, 60, 0.65);
            }
            
            /* üî• –°–¢–ò–õ–ò –î–õ–Ø –°–õ–ê–ô–î–ï–†–û–í –£–†–û–í–ù–Ø 2 –ò 3 - –û–î–ò–ù–ê–ö–û–í–ê–Ø –í–´–°–û–¢–ê */
            .categories-swiper-level-2,
            .categories-swiper-level-3 {
                width: 100%;
                height: 85px; /* –¢–∞–∫–∞—è –∂–µ –≤—ã—Å–æ—Ç–∞ –∫–∞–∫ —É —É—Ä–æ–≤–Ω—è 1 */
                padding: 0;
                margin: 0;
                overflow: hidden;
            }
            
            .categories-swiper-level-2 .swiper-wrapper,
            .categories-swiper-level-3 .swiper-wrapper {
                padding: 0;
            }
            
            .categories-swiper-level-2 .swiper-slide,
            .categories-swiper-level-3 .swiper-slide {
                width: 25% !important; /* –°—Ç—Ä–æ–≥–æ 4 —Å–ª–∞–π–¥–∞ = 25% –∫–∞–∂–¥—ã–π */
                height: 80px !important; /* –¢–∞–∫–∞—è –∂–µ –≤—ã—Å–æ—Ç–∞ –∫–∞–∫ —É —É—Ä–æ–≤–Ω—è 1 */
                display: flex !important;
                justify-content: center;
                align-items: center;
                margin: 0;
                padding: 0;
            }
            
            .categories-swiper-level-2 .category-item,
            .categories-swiper-level-3 .category-item {
                display: block;
                width: 90%; /* –ù–µ–º–Ω–æ–≥–æ –º–µ–Ω—å—à–µ —á–µ–º 100% –¥–ª—è –≤–∏–∑—É–∞–ª—å–Ω–æ–≥–æ –æ—Ç—Å—Ç—É–ø–∞ */
                height: 80px; /* –¢–∞–∫–∞—è –∂–µ –≤—ã—Å–æ—Ç–∞ –∫–∞–∫ —É —É—Ä–æ–≤–Ω—è 1 */
                border-radius: 10px;
                transition: all 0.3s ease;
                position: relative;
                overflow: hidden;
                cursor: pointer;
                border: none;
                background: transparent;
                padding: 0;
                margin: 0 auto;
            }
            
            .categories-swiper-level-2 .category-item:hover,
            .categories-swiper-level-3 .category-item:hover {
                transform: translateY(-2px);
            }
            
            .categories-swiper-level-2 .category-item.active,
            .categories-swiper-level-3 .category-item.active {
                box-shadow: 5px 5px 5px -4px rgba(251, 146, 60, 0.65);
            }
            
            .categories-swiper-level-2 .category-icon,
            .categories-swiper-level-3 .category-icon {
                width: 100%;
                height: 100%;
                transition: all 0.3s ease;
                object-fit: cover;
                display: block;
            }
            
            .categories-swiper-level-2 .category-item.active .category-icon,
            .categories-swiper-level-3 .category-item.active .category-icon {
                box-shadow: 5px 5px 5px -4px rgba(251, 146, 60, 0.65);
            }
        </style>
{% endblock %}

{% block content %}
<div class="pb-20">
                <!-- –†–µ–∫–ª–∞–º–Ω—ã–π —Å–ª–∞–π–¥–µ—Ä -->
                <div class="ads-slider rounded-lg">
                    <div class="ads-slider-container">
                        <div class="ads-slides-wrapper">
                            <div class="ads-slide placeholder">
                                –ú–µ—Å—Ç–æ –¥–ª—è –≤–∞—à–µ–π —Ä–µ–∫–ª–∞–º—ã
                            </div>
                            <div class="ads-slide">
                                <img src="https://wazir.kg/static/reklama.png" alt="wazir">
                            </div>
                        </div>
                    </div>
                </div>

                <!-- –°–ª–∞–π–¥–µ—Ä –∫–∞—Ç–µ–≥–æ—Ä–∏–π —Ç–æ–≤–∞—Ä–æ–≤/—É—Å–ª—É–≥ -->
                {% if general_categories %}
                
                <!-- –û—Å–Ω–æ–≤–Ω–æ–π —É—Ä–æ–≤–µ–Ω—å –∫–∞—Ç–µ–≥–æ—Ä–∏–π (1 —É—Ä–æ–≤–µ–Ω—å) -->
                <div class="categories-slider-container">
                    <div class="swiper categories-swiper">
                        <div class="swiper-wrapper">
                            {% for category in general_categories %}
                            {% if category.level == 1 %}
                            <div class="swiper-slide">
                                <button class="category-item {% if selected_category == category.name or (selected_category == '–ù–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç—å' and category.name == '–ù–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç—å') %}active{% endif %}" 
                                        data-category-id="{{ category.id }}"
                                        data-has-children="{{ category.has_children | lower }}"
                                        data-category-name="{{ category.name }}"
                                        data-level="1">
                                    <img src="{{ category.image }}" alt="{{ category.name }}" class="category-icon">
                                </button>
                            </div>
                            {% endif %}
                            {% endfor %}
                        </div>
                    </div>
                </div>
                
                <!-- –ü–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏–∏ (2 —É—Ä–æ–≤–µ–Ω—å) - —Å–∫—Ä—ã—Ç—ã –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é -->
                <div class="categories-slider-container level-2-container" id="level-2-categories" style="display: none;">
                    <div class="swiper categories-swiper-level-2">
                        <div class="swiper-wrapper">
                            {% for category in general_categories %}
                            {% if category.level == 2 %}
                            <div class="swiper-slide subcategory-slide" data-parent-id="{{ category.parent_id }}">
                                <button class="category-item" 
                                        data-category-id="{{ category.id }}"
                                        data-has-children="{{ category.has_children | lower }}"
                                        data-category-name="{{ category.name }}"
                                        data-level="2">
                                    <img src="{{ category.image }}" alt="{{ category.name }}" class="category-icon">
                                </button>
                            </div>
                            {% endif %}
                            {% endfor %}
                        </div>
                    </div>
                </div>
                
                <!-- –ë—Ä–µ–Ω–¥—ã (3 —É—Ä–æ–≤–µ–Ω—å) - —Å–∫—Ä—ã—Ç—ã –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é -->
                <div class="categories-slider-container level-3-container" id="level-3-categories" style="display: none;">
                    <div class="swiper categories-swiper-level-3">
                        <div class="swiper-wrapper">
                            {% for category in general_categories %}
                            {% if category.level == 3 %}
                            <div class="swiper-slide brand-slide" data-parent-id="{{ category.parent_id }}">
                                <button class="category-item" 
                                        data-category-id="{{ category.id }}"
                                        data-category-name="{{ category.name }}"
                                        data-level="3">
                                    <img src="{{ category.image }}" alt="{{ category.name }}" class="category-icon">
                                </button>
                            </div>
                            {% endif %}
                            {% endfor %}
                        </div>
                    </div>
                </div>
                
                {% endif %}

                <!-- –ö–∞—Ç–µ–≥–æ—Ä–∏–∏ –Ω–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç–∏ -->
                {% if not selected_category or selected_category == "–ù–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç—å" %}
                <div class="mx-auto"
                    style="background-color: #fff;">
                    <div class="grid grid-cols-2 gap-1" style="padding: 10px 7px;">
                        <!-- –ê—Ä–µ–Ω–¥–∞ -->
                        <a href="/mobile/search?q=&category=–ê—Ä–µ–Ω–¥–∞">
                            <div
                                class="category-card rounded-lg {% if selected_category == '–ê—Ä–µ–Ω–¥–∞' %}active{% endif %}"
                                style="background-image: url('https://wazir.kg/static/categories/arenda.png')">
                                <h3
                                    class="category-title text-white font-medium font-montserrat">–ê—Ä–µ–Ω–¥–∞</h3>
                            </div>
                        </a>
                        <!-- –ü—Ä–æ–¥–∞–∂–∞ -->
                        <a href="/mobile/search?q=&category=–ü—Ä–æ–¥–∞–∂–∞">
                            <div
                                class="category-card rounded-lg {% if selected_category == '–ü—Ä–æ–¥–∞–∂–∞' %}active{% endif %}"
                                style="background-image: url('https://wazir.kg/static/categories/prodaja.png')">
                                <h3
                                    class="category-title text-white font-medium font-montserrat">–ü—Ä–æ–¥–∞–∂–∞</h3>
                            </div>
                        </a>
                        <!-- –ù–æ–≤–æ—Å—Ç—Ä–æ–π–∫–∏ -->
                        <a href="/mobile/search?q=&category=–ù–æ–≤–æ—Å—Ç—Ä–æ–π–∫–∏">
                            <div
                                class="category-card rounded-lg {% if selected_category == '–ù–æ–≤–æ—Å—Ç—Ä–æ–π–∫–∏' %}active{% endif %}"
                                style="background-image: url('https://wazir.kg/static/categories/novostroyki.png')">
                                <h3
                                    class="category-title text-white font-medium font-montserrat">–ù–æ–≤–æ—Å—Ç—Ä–æ–π–∫–∏</h3>
                            </div>
                        </a>
                        <!-- –ü–æ—Å—É—Ç–æ—á–Ω–∞—è -->
                        <a href="/mobile/search?q=&category=–ü–æ—Å—É—Ç–æ—á–Ω–∞—è">
                            <div
                                class="category-card rounded-lg {% if selected_category == '–ü–æ—Å—É—Ç–æ—á–Ω–∞—è' %}active{% endif %}"
                                style="background-image: url('https://wazir.kg/static/categories/posutochnaya.png')">
                                <h3
                                    class="category-title text-white font-medium font-montserrat">–ü–æ—Å—É—Ç–æ—á–Ω–∞—è</h3>
                            </div>
                        </a>
                        <!-- –ö–æ–º–º–µ—Ä—á–µ—Å–∫–∞—è -->
                        <a href="/mobile/search?q=&category=–ö–æ–º–º–µ—Ä—á–µ—Å–∫–∞—è">
                            <div
                                class="category-card rounded-lg {% if selected_category == '–ö–æ–º–º–µ—Ä—á–µ—Å–∫–∞—è' %}active{% endif %}"
                                style="background-image: url('https://wazir.kg/static/categories/kommercheskaya.png')">
                                <h3
                                    class="category-title text-white font-medium font-montserrat">–ö–æ–º–º–µ—Ä—á–µ—Å–∫–∞—è</h3>
                            </div>
                        </a>
                        <!-- –ò–ø–æ—Ç–µ–∫–∞ -->
                        <a href="/mobile/search?q=&category=–ò–ø–æ—Ç–µ–∫–∞">
                            <div
                                class="category-card rounded-lg {% if selected_category == '–ò–ø–æ—Ç–µ–∫–∞' %}active{% endif %}"
                                style="background-image: url('https://wazir.kg/static/categories/ipoteka.png')">
                                <h3
                                    class="category-title text-white font-medium font-montserrat">–ò–ø–æ—Ç–µ–∫–∞</h3>
                            </div>
                        </a>
                    </div>
                </div>
                {% endif %}

                <!-- –ü–æ–∏—Å–∫–æ–≤–∞—è —Å—Ç—Ä–æ–∫–∞ –∏ —Ñ–∏–ª—å—Ç—Ä—ã -->
                <div class="container mx-auto px-4 mb-4 mt-3">
                    <form id="search-form" method="get"
                        action="{{ url_for('search') }}">
                        <div class="flex items-center mb-3">
                            <div class="relative flex-1">
                                <input type="text" name="q" id="search-input"
                                    class="bg-white w-full py-3 pl-10 pr-4 rounded-lg shadow-sm text-base"
                                    style="border-bottom: 1px solid #e5e7eb; outline: none;"
                                    placeholder="–ü–æ–∏—Å–∫ –Ω–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç–∏, —É–ª–∏—Ü–∞, —Å–ª–æ–≤–∞"
                                    value="{{ search_query or '' }}">
                                <i
                                    class="fas fa-search absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400"></i>
                            </div>
                            <button id="filter-toggle" type="button"
                                class="ml-2 bg-white p-3 rounded-lg shadow-sm">
                                <i
                                    class="fas fa-sliders-h text-gray-600 text-lg"></i>
                            </button>
                            <input type="hidden" name="category"
                                id="category-input"
                                value="{{ selected_category or '' }}">
                        </div>
                    </form>

                    <!-- –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä –ø—Ä–∏–º–µ–Ω–µ–Ω–Ω—ã—Ö —Ñ–∏–ª—å—Ç—Ä–æ–≤ -->
                    <div id="applied-filters"
                        data-has-filters="{% if filter.price_max or filter.max_area or filter.rooms or filter.apartment_type or filter.house_type or filter.min_floor or filter.max_floor or filter.balcony or filter.furniture or filter.renovation or filter.parking or filter.elevator or filter.owner_only %}true{% else %}false{% endif %}"
                        class="applied-filters {% if max_price or max_area or rooms or apartment_type or house_type or min_floor or max_floor or balcony or furniture or renovation or parking or elevator or owner_only %}visible{% else %}hidden{% endif %}">
                        <span>–ü—Ä–∏–º–µ–Ω–µ–Ω—ã —Ñ–∏–ª—å—Ç—Ä—ã</span>
                        <button id="reset-all-filters"
                            class="text-red-500 flex items-center">
                            <span>–°–±—Ä–æ—Å–∏—Ç—å</span>
                            <i class="fas fa-times-circle ml-1"></i>
                        </button>
                    </div>

                    <!-- –ü–∞–Ω–µ–ª—å —Ñ–∏–ª—å—Ç—Ä–æ–≤ -->
                    <div id="filter-panel"
                        class="filter-panel bg-white rounded-lg shadow-sm p-4 mb-4 closed">
                        <form id="filter-form">
                            <!-- –¶–µ–Ω–∞ -->
                            <div class="mb-5 price-block">
                                <label
                                    class="block text-base font-medium text-gray-700 mb-2">–¶–µ–Ω–∞</label>
                                <div class="price-range mb-6">
                                    <div class="price-progress"
                                        style="left: 0%; right: 0%"></div>
                                </div>
                                <div class="range-input">
                                    <input type="range" name="max_price" min="0"
                                        max="10000000"
                                        value="{{ max_price or 10000000 }}"
                                        class="max-range">
                                </div>
                                <div
                                    class="text-left text-sm text-gray-700 mt-2 font-medium">
                                    <span id="max-price">–¥–æ {{ max_price or
                                        10000000 }} –°–û–ú</span>
                                </div>
                            </div>

                            <!-- –ü–ª–æ—â–∞–¥—å -->
                            <div class="mb-5" id="area-block">
                                <label
                                    class="block text-base font-medium text-gray-700 mb-2">–ü–ª–æ—â–∞–¥—å
                                    (–º¬≤)</label>
                                <div class="price-range mb-6">
                                    <div class="price-progress"
                                        style="left: 0%; right: 0%"></div>
                                </div>
                                <div class="range-input">
                                    <input type="range" name="max_area" min="0"
                                        max="500"
                                        value="{{ max_area or 500 }}"
                                        class="max-area">
                                </div>
                                <div
                                    class="text-left text-sm text-gray-700 mt-2 font-medium">
                                    <span id="max-area">–¥–æ {{ max_area or 500 }}
                                        –º¬≤</span>
                                </div>
                            </div>

                            <!-- –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∫–æ–º–Ω–∞—Ç -->
                            <div class="mb-5">
                                <label
                                    class="block text-base font-medium text-gray-700 mb-2">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ
                                    –∫–æ–º–Ω–∞—Ç</label>
                                <div class="flex flex-wrap gap-2">
                                    <button type="button" data-value="studio"
                                        class="room-btn border border-gray-300 text-gray-700 {% if rooms == 'studio' %}active{% endif %}">–°—Ç—É–¥–∏—è</button>
                                    <button type="button" data-value="1"
                                        class="room-btn border border-gray-300 text-gray-700 {% if rooms == 1 %}active{% endif %}">1</button>
                                    <button type="button" data-value="2"
                                        class="room-btn border border-gray-300 text-gray-700 {% if rooms == 2 %}active{% endif %}">2</button>
                                    <button type="button" data-value="3"
                                        class="room-btn border border-gray-300 text-gray-700 {% if rooms == 3 %}active{% endif %}">3</button>
                                    <button type="button" data-value="4"
                                        class="room-btn border border-gray-300 text-gray-700 {% if rooms == 4 %}active{% endif %}">4</button>
                                    <button type="button" data-value="5"
                                        class="room-btn border border-gray-300 text-gray-700 {% if rooms == 5 %}active{% endif %}">5+</button>
                                    <input type="hidden" name="rooms"
                                        id="rooms-input"
                                        value="{{ rooms or '' }}">
                                </div>
                            </div>

                            <!-- –¢–æ–ª—å–∫–æ –æ—Ç —Å–æ–±—Å—Ç–≤–µ–Ω–Ω–∏–∫–∞ -->
                            <div class="mb-5">
                                <div class="flex items-center">
                                    <label class="flex items-center checkbox-label">
                                        <input type="checkbox" name="owner_only"
                                            value="true" class="mr-2 w-5 h-5" {%
                                            if owner_only %}checked{% endif %}>
                                        –¢–æ–ª—å–∫–æ –æ—Ç —Å–æ–±—Å—Ç–≤–µ–Ω–Ω–∏–∫–∞
                                    </label>
                                </div>
                            </div>

                            <!-- –ö–≤–∞—Ä—Ç–∏—Ä—ã -->
                            <div class="mb-5">
                                <label
                                    class="block text-base font-medium text-gray-700 mb-2">–ö–≤–∞—Ä—Ç–∏—Ä—ã</label>
                                <div class="flex flex-wrap gap-2">
                                    <button type="button" data-value="secondary"
                                        class="apartment-type-btn border border-gray-300 text-gray-700 {% if apartment_type == 'secondary' %}active{% endif %}">–ù–∞ –≤—Ç–æ—Ä–∏—á–∫–µ</button>
                                    <button type="button" data-value="new_building"
                                        class="apartment-type-btn border border-gray-300 text-gray-700 {% if apartment_type == 'new_building' %}active{% endif %}">–í –Ω–æ–≤–æ—Å—Ç—Ä–æ–π–∫–µ</button>
                                    <button type="button" data-value="room"
                                        class="apartment-type-btn border border-gray-300 text-gray-700 {% if apartment_type == 'room' %}active{% endif %}">–ö–æ–º–Ω–∞—Ç–∞</button>
                                    <input type="hidden" name="apartment_type"
                                        id="apartment-type-input"
                                        value="{{ apartment_type or '' }}">
                                </div>
                            </div>

                            <!-- –î–æ–º–∞ –∏ —É—á–∞—Å—Ç–∫–∏ -->
                            <div class="mb-5">
                                <label
                                    class="block text-base font-medium text-gray-700 mb-2">–î–æ–º–∞ –∏ —É—á–∞—Å—Ç–∫–∏</label>
                                <div class="flex flex-wrap gap-2">
                                    <button type="button" data-value="house"
                                        class="house-type-btn border border-gray-300 text-gray-700 {% if house_type == 'house' %}active{% endif %}">–î–æ–º, –¥–∞—á–∞</button>
                                    <button type="button" data-value="plot"
                                        class="house-type-btn border border-gray-300 text-gray-700 {% if house_type == 'plot' %}active{% endif %}">–£—á–∞—Å—Ç–æ–∫</button>
                                    <button type="button" data-value="part_house"
                                        class="house-type-btn border border-gray-300 text-gray-700 {% if house_type == 'part_house' %}active{% endif %}">–ß–∞—Å—Ç—å –¥–æ–º–∞</button>
                                    <input type="hidden" name="house_type"
                                        id="house-type-input"
                                        value="{{ house_type or '' }}">
                                </div>
                            </div>

                            <!-- –≠—Ç–∞–∂ -->
                            <div class="mb-5">
                                <label
                                    class="block text-base font-medium text-gray-700 mb-2">–≠—Ç–∞–∂</label>
                                <div class="grid grid-cols-2 gap-3">
                                    <div>
                                        <label
                                            class="block text-sm text-gray-600 mb-1">–û—Ç</label>
                                        <select name="min_floor"
                                            class="w-full p-3 border border-gray-300 rounded-md text-base">
                                            <option value>–õ—é–±–æ–π</option>
                                            {% for i in range(1, 21) %}
                                            <option value="{{ i }}" {% if
                                                min_floor == i %}selected{%
                                                endif %}>{{ i }}</option>
                                            {% endfor %}
                                        </select>
                                    </div>
                                    <div>
                                        <label
                                            class="block text-sm text-gray-600 mb-1">–î–æ</label>
                                        <select name="max_floor"
                                            class="w-full p-3 border border-gray-300 rounded-md text-base">
                                            <option value>–õ—é–±–æ–π</option>
                                            {% for i in range(1, 21) %}
                                            <option value="{{ i }}" {% if
                                                max_floor == i %}selected{%
                                                endif %}>{{ i }}</option>
                                            {% endfor %}
                                        </select>
                                    </div>
                                </div>
                            </div>

                            <!-- –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –æ–ø—Ü–∏–∏ -->
                            <div class="mb-5">
                                <label
                                    class="block text-base font-medium text-gray-700 mb-3">–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ</label>
                                <div class="grid grid-cols-2 gap-3">
                                    <label
                                        class="flex items-center checkbox-label">
                                        <input type="checkbox" name="balcony"
                                            value="true" class="mr-2 w-5 h-5" {%
                                            if balcony %}checked{% endif %}>
                                        –° –±–∞–ª–∫–æ–Ω–æ–º
                                    </label>
                                    <label
                                        class="flex items-center checkbox-label">
                                        <input type="checkbox" name="furniture"
                                            value="true" class="mr-2 w-5 h-5" {%
                                            if furniture %}checked{% endif %}>
                                        –° –º–µ–±–µ–ª—å—é
                                    </label>
                                    <label
                                        class="flex items-center checkbox-label">
                                        <input type="checkbox" name="renovation"
                                            value="true" class="mr-2 w-5 h-5" {%
                                            if renovation %}checked{% endif %}>
                                        –†–µ–º–æ–Ω—Ç
                                    </label>
                                    <label
                                        class="flex items-center checkbox-label">
                                        <input type="checkbox" name="parking"
                                            value="true" class="mr-2 w-5 h-5" {%
                                            if parking %}checked{% endif %}>
                                        –ü–∞—Ä–∫–∏–Ω–≥
                                    </label>
                                    <label
                                        class="flex items-center checkbox-label">
                                        <input type="checkbox" name="elevator"
                                            value="true" class="mr-2 w-5 h-5" {%
                                            if elevator %}checked{% endif %}>
                                        –õ–∏—Ñ—Ç
                                    </label>
                                </div>
                            </div>

                            <div class="flex space-x-3">
                                <button id="apply-filters" type="button"
                                    class="btn-primary flex-1 py-3 rounded-lg text-base font-medium">–ü—Ä–∏–º–µ–Ω–∏—Ç—å</button>
                                <button id="reset-filters" type="button"
                                    class="btn-secondary w-1/3 py-3 rounded-lg text-base font-medium">–°–±—Ä–æ—Å–∏—Ç—å</button>
                            </div>
                        </form>
                    </div>
                </div>

                <!-- –û–±—ä—è–≤–ª–µ–Ω–∏—è -->
                <div class="container mx-auto px-4">
                    {% if properties %}
                    {% for prop in properties %}
                    <!-- –ö–∞—Ä—Ç–æ—á–∫–∞ –æ–±—ä—è–≤–ª–µ–Ω–∏—è -->
                    <a href="{{ url_for('property', property_id=prop.id) }}" class="block no-underline">
                        <div class="property-card bg-white mb-5 hover:shadow-lg transition-shadow">
                <div class="relative" style="margin-top: 0; margin-bottom: 0;">
                                <!-- –°–ª–∞–π–¥–µ—Ä –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π -->
                                <div class="swiper property-swiper" data-property-id="{{ prop.id }}">
                                    <div class="swiper-wrapper">
                                        {% if prop.images %}
                                        {% for image in prop.images %}
                                        <div class="swiper-slide">
                                <div class="col-span-1 relative">
                                                <img src="{{ image }}"
                                                    alt="{{ prop.title }}"
                                                    class="w-full h-full object-cover">
                                            </div>
                                        </div>
                                        {% endfor %}
                                        {% else %}
                                        <div class="swiper-slide">
                                <div class="col-span-1 relative">
                                                <img
                                                    src="{{ url_for('static', path='layout/assets/img/property-placeholder.jpg') }}"
                                                    alt="–ù–µ—Ç —Ñ–æ—Ç–æ"
                                                    class="w-full h-full object-cover">
                                            </div>
                                        </div>
                                        {% endif %}
                                    </div>
                                </div>
                                
                                <!-- –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ —Ñ–æ—Ç–æ - –î–ò–ù–ê–ú–ò–ß–ï–°–ö–ò–ô -->
                                <div class="absolute bottom-3 right-3 bg-black bg-opacity-75 text-white px-3 py-1 rounded text-sm font-medium z-10 photo-indicator" data-property-id="{{ prop.id }}">
                                    {% if prop.images %}
                                    <span class="current-slide">1</span>/<span class="total-slides">{{ prop.images_count or prop.images|length }}</span>
                                    {% else %}
                                    <span class="current-slide">1</span>/<span class="total-slides">1</span>
                                    {% endif %}
                                </div>
                            </div>

                <div class="px-4 pb-4 pt-0">
                    <!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ –æ–±—ä—è–≤–ª–µ–Ω–∏—è -->
                    <div class="mb-2 mt-2"> 
                        <h2 class="text-lg font-semibold text-gray-900 leading-tight">{{ prop.title or "–ü—Ä–æ–¥–∞–µ—Ç—Å—è –Ω–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç—å" }}</h2>
                    </div>
                                <div class="mb-2">
                                    <h3 class="property-price">{{
                                        "{:,.0f}".format(prop.price).replace(',',
                                        ' ') }} –°–û–ú</h3>
                                </div>
                                <div class="property-info mb-1">
                                    <p>{{ prop.rooms or "?" }}-–∫–æ–º–Ω.–∫–≤ ‚Ä¢ {{
                                        prop.area or "?" }} –º¬≤ ‚Ä¢ {{ prop.floor or
                                        "?" }}/{{ prop.building_floors or "?" }}
                                        —ç—Ç–∞–∂</p>
                                </div>
                                <div class="property-address mb-3">
                                    <p>{{ prop.address
                                        or "–ê–¥—Ä–µ—Å –Ω–µ —É–∫–∞–∑–∞–Ω" }}</p>
                                </div>

                                <!-- –ö–Ω–æ–ø–∫–∏ –¥–µ–π—Å—Ç–≤–∏–π -->
                                <div class="flex" onclick="event.stopPropagation();">
                                    <a href="tel:+996123456789"
                                        class="action-btn call-btn"
                                        onclick="event.stopPropagation();">
                                        <i class="fas fa-phone-alt"></i> –ü–æ–∑–≤–æ–Ω–∏—Ç—å
                                    </a>
                                    <a
                                        href="{{ url_for('property', property_id=prop.id) }}"
                                        class="action-btn details-btn"
                                        onclick="event.stopPropagation();">
                                        <i class="fas fa-info-circle"></i> –ü–æ–¥—Ä–æ–±–Ω–æ
                                    </a>
                                    {% if prop.has_tour %}
                                    <a href="{{ url_for('property', property_id=prop.id) }}?auto360=1"
                                        class="action-btn tour-btn"
                                        onclick="event.stopPropagation();">
                                        <i class="fas fa-vr-cardboard"></i> 360¬∞
                                    </a>
                                    {% else %}
                                    <a href="#" class="action-btn tour-btn"
                                        style="opacity: 0.5; pointer-events: none;"
                                        onclick="event.stopPropagation();">
                                        <i class="fas fa-vr-cardboard"></i> 360¬∞
                                    </a>
                                    {% endif %}
                                </div>
                            </div>
                        </div>
                    </a>
                    {% endfor %}
                    {% else %}
                    <!-- –ï—Å–ª–∏ –Ω–µ—Ç –æ–±—ä—è–≤–ª–µ–Ω–∏–π -->
                    <div class="no-results">
                        <i class="fas fa-search"></i>
                        <h3 class="text-xl font-semibold mb-2">–û–±—ä—è–≤–ª–µ–Ω–∏—è –Ω–µ
                            –Ω–∞–π–¥–µ–Ω—ã</h3>
                        <p class="mb-4">–ü–æ–ø—Ä–æ–±—É–π—Ç–µ –∏–∑–º–µ–Ω–∏—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –ø–æ–∏—Å–∫–∞ –∏–ª–∏
                            —Å–±—Ä–æ—Å–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä—ã</p>
                        <button id="clear-search"
                            class="bg-white text-gray-700 border border-gray-300 py-2 px-4 rounded-lg hover:bg-gray-50">
                            –°–±—Ä–æ—Å–∏—Ç—å –≤—Å–µ —Ñ–∏–ª—å—Ç—Ä—ã
                        </button>
                    </div>
                    {% endif %}
                </div>
                </div>
{% endblock %}

{% block extra_js %}
        <script
            src="https://cdn.jsdelivr.net/npm/swiper@8/swiper-bundle.min.js"></script>
        <script>
        $(document).ready(function() {
            console.log('=== –ö–ê–¢–ï–ì–û–†–ò–ò: –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø ===');
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∑–∞–≥—Ä—É–∑–∫—É –∫–∞—Ç–µ–≥–æ—Ä–∏–π –≤ DOM
            console.log('–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∫–∞—Ç–µ–≥–æ—Ä–∏–π —É—Ä–æ–≤–Ω—è 1:', $('.category-item[data-level="1"]').length);
            console.log('–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∫–∞—Ç–µ–≥–æ—Ä–∏–π —É—Ä–æ–≤–Ω—è 2:', $('.category-item[data-level="2"]').length);
            console.log('–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∫–∞—Ç–µ–≥–æ—Ä–∏–π —É—Ä–æ–≤–Ω—è 3:', $('.category-item[data-level="3"]').length);
            
            // –í—ã–≤–æ–¥–∏–º –≤—Å–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ —É—Ä–æ–≤–Ω—è 1
            $('.category-item[data-level="1"]').each(function() {
                console.log('–ö–∞—Ç–µ–≥–æ—Ä–∏—è 1 —É—Ä–æ–≤–Ω—è:', {
                    id: $(this).data('category-id'),
                    name: $(this).data('category-name'),
                    hasChildren: $(this).data('has-children')
                });
            });
            
            // –í—ã–≤–æ–¥–∏–º –≤—Å–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ —É—Ä–æ–≤–Ω—è 2
            $('.category-item[data-level="2"]').each(function() {
                console.log('–ö–∞—Ç–µ–≥–æ—Ä–∏—è 2 —É—Ä–æ–≤–Ω—è:', {
                    id: $(this).data('category-id'),
                    name: $(this).data('category-name'),
                    parentId: $(this).parent().data('parent-id'),
                    hasChildren: $(this).data('has-children')
                });
            });
            
            // –í—ã–≤–æ–¥–∏–º –≤—Å–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ —É—Ä–æ–≤–Ω—è 3
            $('.category-item[data-level="3"]').each(function() {
                console.log('–ö–∞—Ç–µ–≥–æ—Ä–∏—è 3 —É—Ä–æ–≤–Ω—è:', {
                    id: $(this).data('category-id'),
                    name: $(this).data('category-name'),
                    parentId: $(this).parent().data('parent-id')
                });
            });
            
            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –æ—Å–Ω–æ–≤–Ω–æ–≥–æ —Å–ª–∞–π–¥–µ—Ä–∞ –∫–∞—Ç–µ–≥–æ—Ä–∏–π (—É—Ä–æ–≤–µ–Ω—å 1)
            const categoriesSwiper = new Swiper('.categories-swiper', {
                slidesPerView: 4,
                slidesPerGroup: 4,
                spaceBetween: 0,
                centeredSlides: false,
                freeMode: false,
                loop: false,
                initialSlide: parseInt(localStorage.getItem('categoriesSlideIndex') || 0),
                speed: 600,
                navigation: false,
                pagination: false,
                touchEventsTarget: 'container',
                simulateTouch: true,
                touchRatio: 1,
                touchAngle: 45,
                grabCursor: true,
                allowTouchMove: true,
                on: {
                    slideChange: function() {
                        localStorage.setItem('categoriesSlideIndex', this.activeIndex);
                    }
                }
            });
            
            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Å–ª–∞–π–¥–µ—Ä–∞ –ø–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏–π (—É—Ä–æ–≤–µ–Ω—å 2)
            const level2Swiper = new Swiper('.categories-swiper-level-2', {
                slidesPerView: 4,
                slidesPerGroup: 4,
                spaceBetween: 0,
                centeredSlides: false,
                freeMode: false,
                loop: false,
                speed: 600,
                navigation: false,
                pagination: false,
                touchEventsTarget: 'container',
                simulateTouch: true,
                touchRatio: 1,
                touchAngle: 45,
                grabCursor: true,
                allowTouchMove: true
            });
            
            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Å–ª–∞–π–¥–µ—Ä–∞ –±—Ä–µ–Ω–¥–æ–≤ (—É—Ä–æ–≤–µ–Ω—å 3)
            const level3Swiper = new Swiper('.categories-swiper-level-3', {
                slidesPerView: 4,
                slidesPerGroup: 4,
                spaceBetween: 0,
                centeredSlides: false,
                freeMode: false,
                loop: false,
                speed: 600,
                navigation: false,
                pagination: false,
                touchEventsTarget: 'container',
                simulateTouch: true,
                touchRatio: 1,
                touchAngle: 45,
                grabCursor: true,
                allowTouchMove: true
            });
            
            // üî• –§–£–ù–ö–¶–ò–ò –ü–û–ö–ê–ó–ê/–°–ö–†–´–¢–ò–Ø –ö–ê–¢–ï–ì–û–†–ò–ô üî•
            // –§—É–Ω–∫—Ü–∏—è –ø–æ–∫–∞–∑–∞ –ø–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏–π (—É—Ä–æ–≤–µ–Ω—å 2)
            function showLevel2Categories(parentId) {
                console.log('üî• –§–£–ù–ö–¶–ò–Ø showLevel2Categories –í–´–ó–í–ê–ù–ê!');
                console.log('=== –ü–û–ö–ê–ó –ü–û–î–ö–ê–¢–ï–ì–û–†–ò–ô ===');
                console.log('–†–æ–¥–∏—Ç–µ–ª—å—Å–∫–∏–π ID:', parentId);
                
                // –°–∫—Ä—ã–≤–∞–µ–º –≤—Å–µ —Å–ª–∞–π–¥—ã –ø–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏–π
                $('.subcategory-slide').hide();
                console.log('–°–∫—Ä—ã—Ç—ã –≤—Å–µ —Å–ª–∞–π–¥—ã –ø–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏–π');
                
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ç–æ–ª—å–∫–æ –ø–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –Ω—É–∂–Ω–æ–≥–æ —Ä–æ–¥–∏—Ç–µ–ª—è
                const targetSlides = $(`.subcategory-slide[data-parent-id="${parentId}"]`);
                console.log('–ù–∞–π–¥–µ–Ω–æ –ø–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏–π –¥–ª—è —Ä–æ–¥–∏—Ç–µ–ª—è', parentId, ':', targetSlides.length);
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∫–∞–∂–¥—ã–π —Å–ª–∞–π–¥ –ø–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏–π
                $('.subcategory-slide').each(function() {
                    const slideParentId = $(this).data('parent-id');
                    console.log('–°–ª–∞–π–¥ –ø–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏–∏ parent-id:', slideParentId, '–∏—â–µ–º:', parentId);
                });
                
                targetSlides.show();
                console.log('–ü–æ–∫–∞–∑–∞–Ω—ã –ø–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –¥–ª—è —Ä–æ–¥–∏—Ç–µ–ª—è:', parentId);
                
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –≤–µ—Å—å –±–ª–æ–∫ –ø–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏–π
                $('#level-2-categories').show();
                console.log('–ü–æ–∫–∞–∑–∞–Ω –±–ª–æ–∫ –ø–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏–π');
                
                // –û–±–Ω–æ–≤–ª—è–µ–º –∏ —Å–±—Ä–∞—Å—ã–≤–∞–µ–º —Å–ª–∞–π–¥–µ—Ä
                setTimeout(() => {
                    level2Swiper.update();
                    level2Swiper.slideTo(0, 300);
                    console.log('–°–ª–∞–π–¥–µ—Ä –ø–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏–π –æ–±–Ω–æ–≤–ª–µ–Ω');
                }, 100);
            }
            
            // –§—É–Ω–∫—Ü–∏—è –ø–æ–∫–∞–∑–∞ –±—Ä–µ–Ω–¥–æ–≤ (—É—Ä–æ–≤–µ–Ω—å 3)
            function showLevel3Categories(parentId) {
                console.log('=== –ü–û–ö–ê–ó –ë–†–ï–ù–î–û–í ===');
                console.log('–†–æ–¥–∏—Ç–µ–ª—å—Å–∫–∏–π ID:', parentId);
                
                // –°–∫—Ä—ã–≤–∞–µ–º –≤—Å–µ —Å–ª–∞–π–¥—ã –±—Ä–µ–Ω–¥–æ–≤
                $('.brand-slide').hide();
                console.log('–°–∫—Ä—ã—Ç—ã –≤—Å–µ —Å–ª–∞–π–¥—ã –±—Ä–µ–Ω–¥–æ–≤');
                
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ç–æ–ª—å–∫–æ –±—Ä–µ–Ω–¥—ã –Ω—É–∂–Ω–æ–≥–æ —Ä–æ–¥–∏—Ç–µ–ª—è
                const targetSlides = $(`.brand-slide[data-parent-id="${parentId}"]`);
                console.log('–ù–∞–π–¥–µ–Ω–æ –±—Ä–µ–Ω–¥–æ–≤ –¥–ª—è —Ä–æ–¥–∏—Ç–µ–ª—è', parentId, ':', targetSlides.length);
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∫–∞–∂–¥—ã–π —Å–ª–∞–π–¥ –±—Ä–µ–Ω–¥–æ–≤
                $('.brand-slide').each(function() {
                    const slideParentId = $(this).data('parent-id');
                    console.log('–°–ª–∞–π–¥ –±—Ä–µ–Ω–¥–∞ parent-id:', slideParentId, '–∏—â–µ–º:', parentId);
                });
                
                targetSlides.show();
                console.log('–ü–æ–∫–∞–∑–∞–Ω—ã –±—Ä–µ–Ω–¥—ã –¥–ª—è —Ä–æ–¥–∏—Ç–µ–ª—è:', parentId);
                
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –≤–µ—Å—å –±–ª–æ–∫ –±—Ä–µ–Ω–¥–æ–≤
                $('#level-3-categories').show();
                console.log('–ü–æ–∫–∞–∑–∞–Ω –±–ª–æ–∫ –±—Ä–µ–Ω–¥–æ–≤');
                
                // –û–±–Ω–æ–≤–ª—è–µ–º –∏ —Å–±—Ä–∞—Å—ã–≤–∞–µ–º —Å–ª–∞–π–¥–µ—Ä
                setTimeout(() => {
                    level3Swiper.update();
                    level3Swiper.slideTo(0, 300);
                    console.log('–°–ª–∞–π–¥–µ—Ä –±—Ä–µ–Ω–¥–æ–≤ –æ–±–Ω–æ–≤–ª–µ–Ω');
                }, 100);
            }
            
            // –§—É–Ω–∫—Ü–∏—è —Å–∫—Ä—ã—Ç–∏—è –±—Ä–µ–Ω–¥–æ–≤ (—É—Ä–æ–≤–µ–Ω—å 3)
            function hideLevel3Categories() {
                console.log('–°–∫—Ä—ã–≤–∞–µ–º –±–ª–æ–∫ –±—Ä–µ–Ω–¥–æ–≤');
                $('#level-3-categories').hide();
            }
            
            // üî• –ê–í–¢–û–ú–ê–¢–ò–ß–ï–°–ö–ê–Ø –ê–ö–¢–ò–í–ê–¶–ò–Ø –ö–ê–¢–ï–ì–û–†–ò–ò –ü–†–ò –ó–ê–ì–†–£–ó–ö–ï üî•
            console.log('=== –ü–†–û–í–ï–†–ö–ê –ê–í–¢–û–ê–ö–¢–ò–í–ê–¶–ò–ò ===');
            const currentCategory = '{{ selected_category or "" }}';
            console.log('–¢–µ–∫—É—â–∞—è –≤—ã–±—Ä–∞–Ω–Ω–∞—è –∫–∞—Ç–µ–≥–æ—Ä–∏—è:', currentCategory);
            
            if (currentCategory && currentCategory !== '' && currentCategory !== '–ù–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç—å') {
                console.log('–ò—â–µ–º —Ç–æ–≤–∞—Ä–Ω—É—é –∫–∞—Ç–µ–≥–æ—Ä–∏—é:', currentCategory);
                
                let foundCategory = null;
                let foundLevel = null;
                
                // üî• –ü–û–ò–°–ö –°–†–ï–î–ò –í–°–ï–• –£–†–û–í–ù–ï–ô üî•
                // –ò—â–µ–º –∫–∞—Ç–µ–≥–æ—Ä–∏—é —É—Ä–æ–≤–Ω—è 1
                $('.category-item[data-level="1"]').each(function() {
                    const categoryName = $(this).data('category-name');
                    if (categoryName === currentCategory) {
                        foundCategory = $(this);
                        foundLevel = 1;
                        return false; // –ü—Ä–µ—Ä—ã–≤–∞–µ–º —Ü–∏–∫–ª
                    }
                });
                
                // –ï—Å–ª–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞ –≤ —É—Ä–æ–≤–Ω–µ 1, –∏—â–µ–º –≤ —É—Ä–æ–≤–Ω–µ 2
                if (!foundCategory) {
                    $('.category-item[data-level="2"]').each(function() {
                        const categoryName = $(this).data('category-name');
                        if (categoryName === currentCategory) {
                            foundCategory = $(this);
                            foundLevel = 2;
                            return false;
                        }
                    });
                }
                
                // –ï—Å–ª–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞ –≤ —É—Ä–æ–≤–Ω–µ 2, –∏—â–µ–º –≤ —É—Ä–æ–≤–Ω–µ 3
                if (!foundCategory) {
                    $('.category-item[data-level="3"]').each(function() {
                        const categoryName = $(this).data('category-name');
                        if (categoryName === currentCategory) {
                            foundCategory = $(this);
                            foundLevel = 3;
                            return false;
                        }
                    });
                }
                
                // üî• –í–û–°–°–¢–ê–ù–ê–í–õ–ò–í–ê–ï–ú –¶–ï–ü–û–ß–ö–£ –ö–ê–¢–ï–ì–û–†–ò–ô üî•
                if (foundCategory) {
                    console.log('üéØ –ù–ê–ô–î–ï–ù–ê –ö–ê–¢–ï–ì–û–†–ò–Ø!', {
                        name: foundCategory.data('category-name'),
                        level: foundLevel,
                        id: foundCategory.data('category-id')
                    });
                    
                    if (foundLevel === 1) {
                        // –£—Ä–æ–≤–µ–Ω—å 1: –∞–∫—Ç–∏–≤–∏—Ä—É–µ–º –∫–∞—Ç–µ–≥–æ—Ä–∏—é –∏ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –ø–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏–∏
                        const categoryId = foundCategory.data('category-id');
                        const hasChildren = foundCategory.data('has-children') === true;
                        
                        foundCategory.addClass('active');
                        console.log('–ê–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω–∞ –∫–∞—Ç–µ–≥–æ—Ä–∏—è —É—Ä–æ–≤–Ω—è 1:', foundCategory.data('category-name'));
                        
                        if (hasChildren) {
                            console.log('–ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –¥–ª—è ID:', categoryId);
                            showLevel2Categories(categoryId);
                        }
                    } 
                    else if (foundLevel === 2) {
                        // –£—Ä–æ–≤–µ–Ω—å 2: –∞–∫—Ç–∏–≤–∏—Ä—É–µ–º —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫—É—é –∫–∞—Ç–µ–≥–æ—Ä–∏—é + –ø–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏–∏ + —Ç–µ–∫—É—â—É—é
                        const categoryId = foundCategory.data('category-id');
                        const parentId = foundCategory.parent().data('parent-id');
                        const hasChildren = foundCategory.data('has-children') === true;
                        
                        console.log('–í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ü–µ–ø–æ—á–∫—É –¥–ª—è —É—Ä–æ–≤–Ω—è 2. Parent ID:', parentId);
                        
                        // –ê–∫—Ç–∏–≤–∏—Ä—É–µ–º —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫—É—é –∫–∞—Ç–µ–≥–æ—Ä–∏—é —É—Ä–æ–≤–Ω—è 1
                        $(`.category-item[data-level="1"][data-category-id="${parentId}"]`).addClass('active');
                        console.log('–ê–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω–∞ —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–∞—è –∫–∞—Ç–µ–≥–æ—Ä–∏—è ID:', parentId);
                        
                        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏–∏ —É—Ä–æ–≤–Ω—è 2
                        showLevel2Categories(parentId);
                        
                        // –ê–∫—Ç–∏–≤–∏—Ä—É–µ–º —Ç–µ–∫—É—â—É—é –ø–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏—é —É—Ä–æ–≤–Ω—è 2
                        setTimeout(() => {
                            foundCategory.addClass('active');
                            console.log('–ê–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω–∞ –ø–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏—è —É—Ä–æ–≤–Ω—è 2:', foundCategory.data('category-name'));
                            
                            // –ï—Å–ª–∏ —É –ø–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –µ—Å—Ç—å –±—Ä–µ–Ω–¥—ã, –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –∏—Ö
                            if (hasChildren) {
                                console.log('–ü–æ–∫–∞–∑—ã–≤–∞–µ–º –±—Ä–µ–Ω–¥—ã –¥–ª—è –ø–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏–∏ ID:', categoryId);
                                showLevel3Categories(categoryId);
                            }
                        }, 200);
                    }
                    else if (foundLevel === 3) {
                        // –£—Ä–æ–≤–µ–Ω—å 3: –≤–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –≤—Å—é —Ü–µ–ø–æ—á–∫—É 1‚Üí2‚Üí3
                        const brandId = foundCategory.data('category-id');
                        const subcategoryId = foundCategory.parent().data('parent-id');
                        
                        console.log('–í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ü–µ–ø–æ—á–∫—É –¥–ª—è —É—Ä–æ–≤–Ω—è 3. Subcategory ID:', subcategoryId);
                        
                        // –ù–∞—Ö–æ–¥–∏–º —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫—É—é –∫–∞—Ç–µ–≥–æ—Ä–∏—é –¥–ª—è –ø–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏–∏
                        let parentCategoryId = null;
                        $(`.category-item[data-level="2"][data-category-id="${subcategoryId}"]`).each(function() {
                            parentCategoryId = $(this).parent().data('parent-id');
                        });
                        
                        if (parentCategoryId) {
                            console.log('Parent Category ID:', parentCategoryId);
                            
                            // –ê–∫—Ç–∏–≤–∏—Ä—É–µ–º –∫–∞—Ç–µ–≥–æ—Ä–∏—é —É—Ä–æ–≤–Ω—è 1
                            $(`.category-item[data-level="1"][data-category-id="${parentCategoryId}"]`).addClass('active');
                            console.log('–ê–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω–∞ –∫–∞—Ç–µ–≥–æ—Ä–∏—è —É—Ä–æ–≤–Ω—è 1 ID:', parentCategoryId);
                            
                            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏–∏ —É—Ä–æ–≤–Ω—è 2
                            showLevel2Categories(parentCategoryId);
                            
                            setTimeout(() => {
                                // –ê–∫—Ç–∏–≤–∏—Ä—É–µ–º –ø–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏—é —É—Ä–æ–≤–Ω—è 2
                                $(`.category-item[data-level="2"][data-category-id="${subcategoryId}"]`).addClass('active');
                                console.log('–ê–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω–∞ –ø–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏—è —É—Ä–æ–≤–Ω—è 2 ID:', subcategoryId);
                                
                                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –±—Ä–µ–Ω–¥—ã —É—Ä–æ–≤–Ω—è 3
                                showLevel3Categories(subcategoryId);
                                
                                setTimeout(() => {
                                    // –ê–∫—Ç–∏–≤–∏—Ä—É–µ–º –±—Ä–µ–Ω–¥ —É—Ä–æ–≤–Ω—è 3
                                    foundCategory.addClass('active');
                                    console.log('–ê–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω –±—Ä–µ–Ω–¥ —É—Ä–æ–≤–Ω—è 3:', foundCategory.data('category-name'));
                                }, 200);
                            }, 200);
                        }
                    }
                } else {
                    console.log('‚ùå –ö–∞—Ç–µ–≥–æ—Ä–∏—è –Ω–µ –Ω–∞–π–¥–µ–Ω–∞ —Å—Ä–µ–¥–∏ —Ç–æ–≤–∞—Ä–Ω—ã—Ö –∫–∞—Ç–µ–≥–æ—Ä–∏–π');
                }
            }
            
            // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–ª–∏–∫–æ–≤ –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º
            $(document).on('click', '.category-item', function(e) {
                e.preventDefault();
                
                const categoryId = $(this).data('category-id');
                const hasChildren = $(this).data('has-children') === true; // üî• –ò–°–ü–†–ê–í–õ–ï–ù–û: —Å—Ä–∞–≤–Ω–∏–≤–∞–µ–º —Å boolean true
                const categoryName = $(this).data('category-name');
                const level = $(this).data('level');
                
                console.log('=== –ö–õ–ò–ö –ü–û –ö–ê–¢–ï–ì–û–†–ò–ò ===');
                console.log('ID –∫–∞—Ç–µ–≥–æ—Ä–∏–∏:', categoryId);
                console.log('–ù–∞–∑–≤–∞–Ω–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏:', categoryName);
                console.log('–£—Ä–æ–≤–µ–Ω—å:', level);
                console.log('–ï—Å—Ç—å –¥–µ—Ç–∏:', hasChildren);
                console.log('–¢–∏–ø hasChildren:', typeof $(this).data('has-children'));
                console.log('–°—ã—Ä–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ hasChildren:', $(this).data('has-children'));
                
                // –£–±–∏—Ä–∞–µ–º –∞–∫—Ç–∏–≤–Ω—ã–π –∫–ª–∞—Å—Å —Å–æ –≤—Å–µ—Ö –∫–Ω–æ–ø–æ–∫ —ç—Ç–æ–≥–æ —É—Ä–æ–≤–Ω—è
                $(`.category-item[data-level="${level}"]`).removeClass('active');
                // –î–æ–±–∞–≤–ª—è–µ–º –∞–∫—Ç–∏–≤–Ω—ã–π –∫–ª–∞—Å—Å –∫ —Ç–µ–∫—É—â–µ–π –∫–Ω–æ–ø–∫–µ
                $(this).addClass('active');
                
                if (level === 1) {
                    localStorage.setItem('categoriesSlideIndex', categoriesSwiper.activeIndex);
                    
                    if (hasChildren) {
                        console.log('–ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –¥–ª—è –∫–∞—Ç–µ–≥–æ—Ä–∏–∏:', categoryId);
                        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏–∏ —Å–Ω–∏–∑—É
                        showLevel2Categories(categoryId);
                        // –°–∫—Ä—ã–≤–∞–µ–º —É—Ä–æ–≤–µ–Ω—å 3 –µ—Å–ª–∏ –±—ã–ª –æ—Ç–∫—Ä—ã—Ç
                        hideLevel3Categories();
                    } else {
                        console.log('–ü–µ—Ä–µ—Ö–æ–¥–∏–º –Ω–∞ –ø–æ–∏—Å–∫ –¥–ª—è –∫–∞—Ç–µ–≥–æ—Ä–∏–∏:', categoryName);
                        // –ü–µ—Ä–µ—Ö–æ–¥–∏–º –Ω–∞ –ø–æ–∏—Å–∫
                        window.location.href = `/mobile/search?category=${encodeURIComponent(categoryName)}`;
                    }
                } else if (level === 2) {
                    if (hasChildren) {
                        console.log('–ü–æ–∫–∞–∑—ã–≤–∞–µ–º –±—Ä–µ–Ω–¥—ã –¥–ª—è –ø–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏–∏:', categoryId);
                        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –±—Ä–µ–Ω–¥—ã —Å–Ω–∏–∑—É
                        showLevel3Categories(categoryId);
                    } else {
                        console.log('–ü–µ—Ä–µ—Ö–æ–¥–∏–º –Ω–∞ –ø–æ–∏—Å–∫ –¥–ª—è –ø–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏–∏:', categoryName);
                        // –ü–µ—Ä–µ—Ö–æ–¥–∏–º –Ω–∞ –ø–æ–∏—Å–∫
                        window.location.href = `/mobile/search?category=${encodeURIComponent(categoryName)}`;
                    }
                } else if (level === 3) {
                    console.log('–ü–µ—Ä–µ—Ö–æ–¥–∏–º –Ω–∞ –ø–æ–∏—Å–∫ –¥–ª—è –±—Ä–µ–Ω–¥–∞:', categoryName);
                    // –ü–µ—Ä–µ—Ö–æ–¥–∏–º –Ω–∞ –ø–æ–∏—Å–∫
                    window.location.href = `/mobile/search?category=${encodeURIComponent(categoryName)}`;
                }
            });
            
            console.log('=== –°–õ–ê–ô–î–ï–†–´ –ö–ê–¢–ï–ì–û–†–ò–ô –ò–ù–ò–¶–ò–ê–õ–ò–ó–ò–†–û–í–ê–ù–´ ===');
            console.log('–ù–∞—á–∞–ª—å–Ω—ã–π —Å–ª–∞–π–¥:', localStorage.getItem('categoriesSlideIndex'));
            
            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Å–ª–∞–π–¥–µ—Ä–∞ –¥–ª—è –∫–∞–∂–¥–æ–π –∫–∞—Ä—Ç–æ—á–∫–∏ —Å –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–º–∏ –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–∞–º–∏
            $('.property-swiper').each(function(index, element) {
                const propertyId = $(element).data('property-id');
                const swiper = new Swiper(element, {
                    loop: true,
                    on: {
                        slideChange: function() {
                            // –û–±–Ω–æ–≤–ª—è–µ–º –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä –¥–ª—è —ç—Ç–æ–≥–æ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ —Å–ª–∞–π–¥–µ—Ä–∞
                            const indicator = $(`.photo-indicator[data-property-id="${propertyId}"]`);
                            const currentSlide = this.realIndex + 1; // realIndex –¥–ª—è loop
                            indicator.find('.current-slide').text(currentSlide);
                        }
                    }
                });
            });
            
            // –§—É–Ω–∫—Ü–∏—è –¥–ª—è —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —á–∏—Å–µ–ª —Å –ø—Ä–æ–±–µ–ª–∞–º–∏
            function formatNumber(num) {
                return num.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ' ');
            }
            
            // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –≤–∏–¥–∏–º–æ—Å—Ç–∏ –ø–∞–Ω–µ–ª–∏ —Ñ–∏–ª—å—Ç—Ä–æ–≤ –ø—Ä–∏ –Ω–∞–∂–∞—Ç–∏–∏ –Ω–∞ –∫–Ω–æ–ø–∫—É
            $('#filter-toggle').on('click', function() {
                const filterPanel = $('#filter-panel');
                
                if (filterPanel.hasClass('open')) {
                    // –ï—Å–ª–∏ –ø–∞–Ω–µ–ª—å –æ—Ç–∫—Ä—ã—Ç–∞, –∑–∞–∫—Ä—ã–≤–∞–µ–º –µ—ë
                    filterPanel.removeClass('open');
                    
                    // –ü–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –∞–Ω–∏–º–∞—Ü–∏–∏ max-height –¥–æ–±–∞–≤–ª—è–µ–º –∫–ª–∞—Å—Å closed
                    setTimeout(function() {
                        filterPanel.addClass('closed');
                    }, 500); // –¢–∞–π–º–∞—É—Ç —Ä–∞–≤–µ–Ω –≤—Ä–µ–º–µ–Ω–∏ transition
                } else {
                    // –ï—Å–ª–∏ –ø–∞–Ω–µ–ª—å –∑–∞–∫—Ä—ã—Ç–∞, –æ—Ç–∫—Ä—ã–≤–∞–µ–º –µ—ë
                    filterPanel.removeClass('closed').addClass('open');
                }
            });

            // –û–±—Ä–∞–±–æ—Ç–∫–∞ —Ñ–∏–ª—å—Ç—Ä–æ–≤ —Ü–µ–Ω—ã
            const priceMaxRange = document.querySelector('.max-range');
            const maxPriceDisplay = document.getElementById('max-price');
            const priceProgress = document.querySelector('.price-block .price-progress');
            
            function updatePriceRanges() {
                const maxVal = parseInt(priceMaxRange.value);
                
                maxPriceDisplay.textContent = '–¥–æ ' + formatNumber(maxVal) + ' –°–û–ú';
                
                if (priceProgress) {
                    const leftPercent = 0;
                    const rightPercent = 100 - ((maxVal / 10000000) * 100);
                    priceProgress.style.left = leftPercent + '%';
                    priceProgress.style.right = rightPercent + '%';
                }
            }
            
            priceMaxRange.addEventListener('input', updatePriceRanges);

            // –û–±—Ä–∞–±–æ—Ç–∫–∞ —Ñ–∏–ª—å—Ç—Ä–æ–≤ –ø–ª–æ—â–∞–¥–∏
            const areaMaxRange = document.querySelector('.max-area');
            const maxAreaDisplay = document.getElementById('max-area');
            const areaProgress = document.querySelector('#area-block .price-progress');
            
            function updateAreaRanges() {
                const maxVal = parseInt(areaMaxRange.value);
                
                maxAreaDisplay.textContent = '–¥–æ ' + formatNumber(maxVal) + ' –º¬≤';
                
                if (areaProgress) {
                    const leftPercent = 0;
                    const rightPercent = 100 - ((maxVal / 500) * 100);
                    areaProgress.style.left = leftPercent + '%';
                    areaProgress.style.right = rightPercent + '%';
                }
            }
            
            areaMaxRange.addEventListener('input', updateAreaRanges);

            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è progress bar –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
            updatePriceRanges();
            updateAreaRanges();

            // –û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–Ω–æ–ø–æ–∫ –≤—ã–±–æ—Ä–∞ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –∫–æ–º–Ω–∞—Ç
            $('.room-btn').on('click', function() {
                $('.room-btn').removeClass('active');
                $(this).addClass('active');
                $('#rooms-input').val($(this).data('value'));
            });

            // –û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–Ω–æ–ø–æ–∫ –≤—ã–±–æ—Ä–∞ —Ç–∏–ø–∞ –∫–≤–∞—Ä—Ç–∏—Ä
            $('.apartment-type-btn').on('click', function() {
                $('.apartment-type-btn').removeClass('active');
                $(this).addClass('active');
                $('#apartment-type-input').val($(this).data('value'));
            });

            // –û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–Ω–æ–ø–æ–∫ –≤—ã–±–æ—Ä–∞ —Ç–∏–ø–∞ –¥–æ–º–æ–≤ –∏ —É—á–∞—Å—Ç–∫–æ–≤
            $('.house-type-btn').on('click', function() {
                $('.house-type-btn').removeClass('active');
                $(this).addClass('active');
                $('#house-type-input').val($(this).data('value'));
            });

            // –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ —Ñ–∏–ª—å—Ç—Ä–æ–≤
            $('#apply-filters').on('click', function() {
                const searchQuery = $('#search-input').val();
                const category = $('#category-input').val();
                const maxPrice = priceMaxRange.value;
                const maxArea = areaMaxRange.value;
                let rooms = $('#rooms-input').val();
                
                // –û–±—Ä–∞–±–æ—Ç–∫–∞ –∑–Ω–∞—á–µ–Ω–∏—è "studio" - –∫–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ–º –≤ 0 –¥–ª—è backend
                if (rooms === 'studio') {
                    rooms = '0';
                }
                
                const apartmentType = $('#apartment-type-input').val();
                const houseType = $('#house-type-input').val();
                const minFloor = $('select[name="min_floor"]').val();
                const maxFloor = $('select[name="max_floor"]').val();
                
                // –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã
                const balcony = $('input[name="balcony"]').is(':checked') ? 'true' : '';
                const furniture = $('input[name="furniture"]').is(':checked') ? 'true' : '';
                const renovation = $('input[name="renovation"]').is(':checked') ? 'true' : '';
                const parking = $('input[name="parking"]').is(':checked') ? 'true' : '';
                const elevator = $('input[name="elevator"]').is(':checked') ? 'true' : '';
                const ownerOnly = $('input[name="owner_only"]').is(':checked') ? 'true' : '';
                
                // –§–æ—Ä–º–∏—Ä—É–µ–º —Å—Ç—Ä–æ–∫—É –∑–∞–ø—Ä–æ—Å–∞
                let queryParams = new URLSearchParams();
                if (searchQuery) queryParams.append('q', searchQuery);
                if (category) queryParams.append('category', category);
                if (maxPrice && maxPrice < 10000000) queryParams.append('price_max', maxPrice);
                if (maxArea && maxArea < 500) queryParams.append('max_area', maxArea);
                if (rooms) queryParams.append('rooms', rooms);
                if (apartmentType) queryParams.append('apartment_type', apartmentType);
                if (houseType) queryParams.append('house_type', houseType);
                if (minFloor) queryParams.append('min_floor', minFloor);
                if (maxFloor) queryParams.append('max_floor', maxFloor);
                if (balcony) queryParams.append('balcony', balcony);
                if (furniture) queryParams.append('furniture', furniture);
                if (renovation) queryParams.append('renovation', renovation);
                if (parking) queryParams.append('parking', parking);
                if (elevator) queryParams.append('elevator', elevator);
                if (ownerOnly) queryParams.append('owner_only', ownerOnly);
                
                // –ü–µ—Ä–µ—Ö–æ–¥–∏–º –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É —Å –ø—Ä–∏–º–µ–Ω–µ–Ω–Ω—ã–º–∏ —Ñ–∏–ª—å—Ç—Ä–∞–º–∏
                window.location.href = '/mobile/search?' + queryParams.toString();
            });

            // –°–±—Ä–æ—Å –≤—Å–µ—Ö —Ñ–∏–ª—å—Ç—Ä–æ–≤
            $('#reset-filters, #reset-all-filters, #clear-search').on('click', function() {
                window.location.href = '/mobile/search';
            });
            
            // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –æ –ø–æ–≥–æ–¥–µ —á–µ—Ä–µ–∑ Visual Crossing Weather
            function getWeather() {
                // –°–Ω–∞—á–∞–ª–∞ –ø—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
                const cachedWeather = getWeatherFromCache();
                if (cachedWeather) {
                    // –ï—Å–ª–∏ –µ—Å—Ç—å –∫—ç—à–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ, —Å—Ä–∞–∑—É –∏—Ö –æ—Ç–æ–±—Ä–∞–∂–∞–µ–º
                    displayWeatherData(cachedWeather);
                    return;
                }
                
                // –ï—Å–ª–∏ –∫—ç—à–∞ –Ω–µ—Ç –∏–ª–∏ –æ–Ω —É—Å—Ç–∞—Ä–µ–ª, –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ–º –¥–∞–Ω–Ω—ã–µ —Å API
                const city = "Osh,Kyrgyzstan";
                const apiKey = "JPWU9UY254WNDKUNM9MH9E8AR"; // –ü—É–±–ª–∏—á–Ω—ã–π –∫–ª—é—á —Å –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è–º–∏
                
                $.ajax({
                    url: `https://weather.visualcrossing.com/VisualCrossingWebServices/rest/services/timeline/${city}/today`,
                    data: {
                        unitGroup: "metric",
                        key: apiKey,
                        include: "current"
                    },
                    success: function(data) {
                        try {
                            if (data && data.currentConditions && data.currentConditions.temp !== undefined) {
                                // –û–∫—Ä—É–≥–ª—è–µ–º —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä—É –¥–æ —Ü–µ–ª–æ–≥–æ —á–∏—Å–ª–∞
                                const temp = Math.round(data.currentConditions.temp);
                                
                                // –ü–æ–ª—É—á–∞–µ–º –∫–æ–¥ —Å–æ—Å—Ç–æ—è–Ω–∏—è –ø–æ–≥–æ–¥—ã –∏ —Å–æ–∑–¥–∞–µ–º –∏–∫–æ–Ω–∫—É
                                const condition = data.currentConditions.conditions ? 
                                    data.currentConditions.conditions.toLowerCase() : '';
                                const iconCode = data.currentConditions.icon ? 
                                    data.currentConditions.icon.toLowerCase() : '';
                                
                                let iconHtml;
                                // –û–ø—Ä–µ–¥–µ–ª—è–µ–º –∏–∫–æ–Ω–∫—É –Ω–∞ –æ—Å–Ω–æ–≤–µ –∫–æ–¥–∞ –ø–æ–≥–æ–¥—ã Visual Crossing
                                if (iconCode.includes('rain') || condition.includes('–¥–æ–∂–¥—å') || condition.includes('–æ—Å–∞–¥–∫–∏')) {
                                    // –î–æ–∂–¥—å
                                    iconHtml = `<svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="#4c94f2" stroke-width="1.75" stroke-linecap="round" stroke-linejoin="round" class="weather-icon"><line x1="16" y1="13" x2="16" y2="21"></line><line x1="8" y1="13" x2="8" y2="21"></line><line x1="12" y1="15" x2="12" y2="23"></line><path d="M20 16.58A5 5 0 0 0 18 7h-1.26A8 8 0 1 0 4 15.25"></path></svg>`;
                                } else if (iconCode.includes('snow') || condition.includes('—Å–Ω–µ–≥')) {
                                    // –°–Ω–µ–≥
                                    iconHtml = `<svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="#9cc0fa" stroke-width="1.75" stroke-linecap="round" stroke-linejoin="round" class="weather-icon"><path d="M20 17.58A5 5 0 0 0 18 8h-1.26A8 8 0 1 0 4 16.25"></path><line x1="8" y1="16" x2="8.01" y2="16"></line><line x1="8" y1="20" x2="8.01" y2="20"></line><line x1="12" y1="18" x2="12.01" y2="18"></line><line x1="12" y1="22" x2="12.01" y2="22"></line><line x1="16" y1="16" x2="16.01" y2="16"></line><line x1="16" y1="20" x2="16.01" y2="20"></line></svg>`;
                                } else if (iconCode.includes('thunder') || iconCode.includes('lightning') || condition.includes('–≥—Ä–æ–∑–∞')) {
                                    // –ì—Ä–æ–∑–∞
                                    iconHtml = `<svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="#7c8aa0" stroke-width="1.75" stroke-linecap="round" stroke-linejoin="round" class="weather-icon"><path d="M19 16.9A5 5 0 0 0 18 7h-1.26a8 8 0 1 0-11.62 9"></path><polyline points="13 11 9 17 15 17 11 23"></polyline></svg>`;
                                } else if (iconCode.includes('fog') || iconCode.includes('mist') || condition.includes('—Ç—É–º–∞–Ω') || condition.includes('–¥—ã–º–∫–∞')) {
                                    // –¢—É–º–∞–Ω
                                    iconHtml = `<svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="#7c8aa0" stroke-width="1.75" stroke-linecap="round" stroke-linejoin="round" class="weather-icon"><path d="M18 10h-1.26A8 8 0 1 0 9 20h9a5 5 0 0 0 0-10z"></path></svg>`;
                                } else if (iconCode === 'clear-day' || iconCode === 'clear-night' || condition.includes('—è—Å–Ω–æ')) {
                                    // –Ø—Å–Ω–æ
                                    iconHtml = `<svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="#f59e0b" stroke-width="1.75" stroke-linecap="round" stroke-linejoin="round" class="weather-icon"><circle cx="12" cy="12" r="5"></circle><line x1="12" y1="1" x2="12" y2="3"></line><line x1="12" y1="21" x2="12" y2="23"></line><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line><line x1="1" y1="12" x2="3" y2="12"></line><line x1="21" y1="12" x2="23" y2="12"></line><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line></svg>`;
                                } else if (iconCode.includes('cloud') || condition.includes('–æ–±–ª–∞—á–Ω–æ') || condition.includes('–ø–∞—Å–º—É—Ä–Ω–æ')) {
                                    // –û–±–ª–∞—á–Ω–æ
                                    iconHtml = `<svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="#7c8aa0" stroke-width="1.75" stroke-linecap="round" stroke-linejoin="round" class="weather-icon"><path d="M18 10h-1.26A8 8 0 1 0 9 20h9a5 5 0 0 0 0-10z"></path></svg>`;
                                } else {
                                    // –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é –∏–ª–∏ –¥–ª—è –¥—Ä—É–≥–∏—Ö —É—Å–ª–æ–≤–∏–π
                                    iconHtml = `<svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="#7c8aa0" stroke-width="1.75" stroke-linecap="round" stroke-linejoin="round" class="weather-icon"><path d="M18 10h-1.26A8 8 0 1 0 9 20h9a5 5 0 0 0 0-10z"></path></svg>`;
                                }
                                
                                // –°–æ—Ö—Ä–∞–Ω—è–µ–º –¥–∞–Ω–Ω—ã–µ –≤ –∫—ç—à
                                const weatherData = {
                                    temp: temp,
                                    iconHtml: iconHtml,
                                    condition: condition
                                };
                                saveWeatherToCache(weatherData);
                                
                                // –û—Ç–æ–±—Ä–∞–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ
                                displayWeatherData(weatherData);
                            } else {
                                showFallbackWeather();
                            }
                        } catch (e) {
                            showFallbackWeather();
                        }
                    },
                    error: function() {
                        // –ü—Ä–∏ –æ—à–∏–±–∫–µ –∏—Å–ø–æ–ª—å–∑—É–µ–º —Ä–µ–∑–µ—Ä–≤–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
                        showFallbackWeather();
                    }
                });
            }

            // –ü—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã –ø—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ –ø—Ä–∏–º–µ–Ω–µ–Ω–Ω—ã–µ —Ñ–∏–ª—å—Ç—Ä—ã
            if ($('#applied-filters').data('has-filters') === 'true') {
                $('#applied-filters').addClass('visible');
            }
            
            // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Å–ª–∞–π–¥–µ—Ä –¥–ª—è —Ä–µ–∫–ª–∞–º—ã
            function initAdsSlider() {
                const slidesWrapper = document.querySelector('.ads-slides-wrapper');
                const slides = document.querySelectorAll('.ads-slide');
                let currentSlide = 0;
                
                function showSlide(index) {
                    const translateX = -(index * 50); // 50% –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Å–ª–∞–π–¥–∞
                    slidesWrapper.style.transform = `translateX(${translateX}%)`;
                }
                
                function nextSlide() {
                    currentSlide = (currentSlide + 1) % slides.length;
                    showSlide(currentSlide);
                }
                
                // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –∫–∞–∂–¥—ã–µ 3 —Å–µ–∫—É–Ω–¥—ã
                setInterval(nextSlide, 2000);
            }
            
            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º —Å–ª–∞–π–¥–µ—Ä –ø–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏ DOM
            initAdsSlider();
        });
        </script>
{% endblock %}